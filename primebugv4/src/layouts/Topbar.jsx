// src/layouts/Topbar.jsx\nimport React, { useState, useEffect, useRef } from \'react\';\nimport { NavLink, useLocation, Link } from \'react-router-dom\';\nimport { useAuth } from \'../contexts/AuthContext.jsx\';\nimport { doc, getDoc } from \'firebase/firestore\';\nimport { db } from \'../firebase\';\nimport Tippy from \'@tippyjs/react\';\nimport \'tippy.js/dist/tippy.css\';\nimport { FaBell, FaPlus, FaBars, FaChevronRight } from \'react-icons/fa\';\nimport NotificationsDropdown from \'./NotificationsDropdown.jsx\';\n\nconst friendlyNames = {\n    \'equipos\': \'Equipos\',\n    \'miembros\': \'Miembros\',\n    \'proyectos\': \'Proyectos\',\n    \'archivos\': \'Archivos\',\n    \'incidencias\': \'Incidencias\',\n    \'crear\': \'Crear\',\n};\n\nconst useDocumentName = (collectionName, docId, user) => {\n    const [name, setName] = useState(docId);\n\n    useEffect(() => {\n        if (!docId || !collectionName || !user || docId.length !== 20) {\n            setName(friendlyNames[docId] || docId);\n            return;\n        }\n\n        const fetchName = async () => {\n            try {\n                const docRef = doc(db, collectionName, docId);\n                const docSnap = await getDoc(docRef);\n                setName(docSnap.exists() ? (docSnap.data().nombre || docSnap.data().name || docId) : docId);\n            } catch (e) {\n                console.error(`Error fetching document name:`, e);\n                setName(docId);\n            }\n        };\n\n        fetchName();\n    }, [docId, collectionName, user]);\n\n    return name;\n};\n\nconst BreadcrumbItem = ({ segment, collectionName, isLast, user }) => {\n    const name = useDocumentName(collectionName, segment, user);\n    const classes = isLast\n        ? \'text-indigo-600 font-bold pointer-events-none\' \n        : \'text-slate-500 hover:text-indigo-600\';\n\n    return <span className={`transition-colors truncate ${classes}`}>{name}</span>;\n};\n\nconst Topbar = ({ toggleSidebar }) => {\n  const { user } = useAuth();\n  const location = useLocation();\n  const notificationsRef = useRef(null);\n  const [isNotificationsOpen, setNotificationsOpen] = useState(false);\n\n  // **CORRECCIÃ“N: Filtrar \'dashboard\' del breadcrumb**\n  const pathSegments = location.pathname.split(\'/\').filter(segment => segment && segment.toLowerCase() !== \'dashboard\');\n\n  return (\n    <header className=\"sticky top-0 z-30 bg-slate-100/80 backdrop-blur-sm\">\n       <div className=\"flex items-center justify-between h-16 px-4 sm:px-6 border-b border-slate-200\">\n            <div className=\"flex items-center gap-x-3 overflow-hidden\">\n                <button onClick={toggleSidebar} className=\"p-2 text-slate-500 rounded-full md:hidden\">\n                    <FaBars className=\"h-6 w-6\" />\n                </button>\n                \n                <nav className=\"flex items-center text-sm font-semibold whitespace-nowrap\">\n                    <Link to=\"/dashboard\" className=\"text-slate-500 hover:text-indigo-600 flex-shrink-0\">\n                        Dashboard\n                    </Link>\n                    {pathSegments.map((segment, index) => {\n                        const builtPath = \`/dashboard/${pathSegments.slice(0, index + 1).join(\'/\')}`;\n                        const lastSegment = pathSegments[index - 1];\n                        \n                        let collectionName = null;\n                        if (lastSegment === \'proyectos\') collectionName = \'projects\';\n                        if (lastSegment === \'equipos\') collectionName = \'teams\';\n\n                        return (\n                            <React.Fragment key={index}>\n                                <FaChevronRight className=\"h-3 w-3 text-slate-400 mx-2 flex-shrink-0\" />\n                                <Link to={builtPath} className=\"truncate\">\n                                    <BreadcrumbItem \n                                        segment={segment} \n                                        collectionName={collectionName}\n                                        isLast={index === pathSegments.length - 1}\n                                        user={user}\n                                    />\n                                </Link>\n                            </React.Fragment>\n                        );\n                    })}\n                </nav>\n            </div>\n\n            {user && <div className=\"flex items-center gap-x-2\">\n                 <Tippy content=\"Reportar Bug\" placement=\"bottom\">\n                    <NavLink to=\"/proyectos\" className=\"btn-primary flex items-center gap-x-2 px-3 py-2 text-sm\">\n                        <FaPlus />\n                        <span className=\"hidden sm:inline\">Nuevo Bug</span>\n                    </NavLink>\n                </Tippy>\n                \n                 <div className=\"relative\" ref={notificationsRef}>\n                    {/* Placeholder para notificaciones */}\n                </div>\n            </div>}\n        </div>\n    </header>\n  );\n};\n\nexport default Topbar;\n